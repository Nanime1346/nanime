<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NAnime - Anime, Manga & Movies</title>
<meta name="description" content="Discover anime, manga, and movies. Filter by genre, year, and type. No Hentai.">

<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: '#ff0033',
        dark: '#000000',
        offwhite: '#f0f0f0',
        lightgray: '#bbbbbb'
      }
    }
  }
}
</script>

<link rel="icon" href="image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23000000'/><text y='0.9em' font-size='90' fill='%23ff0033'>N</text></svg>">

<style>
.bookmark-btn{background:none;border:none;color:#777;font-size:1.4rem;cursor:pointer;position:absolute;top:.5rem;right:.5rem}
.bookmark-btn.active{color:gold}
.media-item{position:relative}
.genre-tag{background:#222;padding:.25rem .75rem;border-radius:999px;cursor:pointer}
.genre-tag.selected{background:#ff0033;color:#fff}
</style>
</head>

<body class="bg-dark text-offwhite min-h-screen">

<div id="app" class="container mx-auto px-4 py-8 max-w-7xl">

<header class="text-center mb-8">
<h1 class="text-5xl font-bold"><span class="text-primary">N</span>Anime</h1>
<p class="text-lightgray mt-2">Anime • Manga • Movies</p>
</header>

<input id="search-input" placeholder="Search..." class="w-full bg-gray-900 border border-gray-700 rounded-full py-3 px-5 mb-6">

<div id="genre-filters" class="flex flex-wrap gap-2 mb-6"></div>

<select id="filter-year" class="bg-gray-800 px-3 py-2 rounded mb-6">
<option value="">All Years</option>
</select>

<div class="flex gap-2 mb-6">
<button id="tab-anime" class="bg-primary px-4 py-2 rounded">Anime</button>
<button id="tab-manga" class="bg-gray-800 px-4 py-2 rounded">Manga</button>
<button id="tab-movies" class="bg-gray-800 px-4 py-2 rounded">Movies</button>
</div>

<section id="anime-section">
<div id="anime-list"></div>
<button id="load-more-anime" class="mt-4 text-primary">Load More</button>
</section>

<section id="manga-section" class="hidden">
<div id="manga-list"></div>
<button id="load-more-manga" class="mt-4 text-primary">Load More</button>
</section>

<section id="movies-section" class="hidden">
<div id="movies-list-main"></div>
<button id="load-more-movies" class="mt-4 text-primary">Load More</button>
</section>

</div>

<script>
/* ---------------- STATE ---------------- */
let currentView='anime';
let animePage=1,mangaPage=1,moviesPage=1;
let selectedGenres=[],selectedYear='';
const BOOKMARK_KEY='nanime-bookmarks';

/* ---------------- HELPERS ---------------- */
function getBookmarks(){return JSON.parse(localStorage.getItem(BOOKMARK_KEY)||'[]')}
function setBookmarks(b){localStorage.setItem(BOOKMARK_KEY,JSON.stringify(b))}

/* ---------------- YEAR ---------------- */
(function(){
const y=document.getElementById('filter-year');
for(let i=new Date().getFullYear();i>=1980;i--){
y.innerHTML+=`<option>${i}</option>`;
}
})();

/* ---------------- GENRES ---------------- */
async function loadGenres(){
const q=`query{GenreCollection}`;
const r=await fetch('https://graphql.anilist.co',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:q})});
const d=await r.json();
document.getElementById('genre-filters').innerHTML=
d.data.GenreCollection.filter(g=>g.toLowerCase()!=='hentai')
.map(g=>`<span class="genre-tag" data-g="${g}">${g}</span>`).join('');
document.querySelectorAll('.genre-tag').forEach(t=>{
t.onclick=()=>{
t.classList.toggle('selected');
selectedGenres=[...document.querySelectorAll('.genre-tag.selected')].map(e=>e.dataset.g);
applyFilters();
};
});
}

/* ---------------- TABS ---------------- */
function setTab(t){
currentView=t;
['anime','manga','movies'].forEach(v=>{
document.getElementById(v+'-section').classList.toggle('hidden',v!==t);
});
applyFilters();
}
tab-anime.onclick=()=>setTab('anime');
tab-manga.onclick=()=>setTab('manga');
tab-movies.onclick=()=>setTab('movies');

/* ---------------- FILTERS ---------------- */
function applyFilters(){
selectedYear=document.getElementById('filter-year').value;
animePage=mangaPage=moviesPage=1;
if(currentView==='anime')loadAnime();
if(currentView==='manga')loadManga();
if(currentView==='movies')loadMovies();
}

/* ---------------- FETCHERS ---------------- */
async function fetchMedia(vars,query){
const r=await fetch('https://graphql.anilist.co',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query,variables:vars})});
return (await r.json()).data.Page.media;
}

function dateVars(v){
if(selectedYear){
v.startDate_greater=Number(selectedYear+'0000');
v.endDate_lesser=Number(selectedYear+'1231');
}
}

/* ---------------- LOADERS ---------------- */
async function loadAnime(append=false){
let v={page:animePage,genres:selectedGenres};
dateVars(v);
const q=`query($page:Int,$genres:[String],$startDate_greater:Int,$endDate_lesser:Int){
Page(page:$page,perPage:20){media(type:ANIME,genres_in:$genres,startDate_greater:$startDate_greater,endDate_lesser:$endDate_lesser){id title{romaji} coverImage{large} episodes startDate{year}}}}`;
render('anime-list',await fetchMedia(v,q),append,'ANIME');
animePage++;
}

async function loadManga(append=false){
let v={page:mangaPage,genres:selectedGenres};
dateVars(v);
const q=`query($page:Int,$genres:[String],$startDate_greater:Int,$endDate_lesser:Int){
Page(page:$page,perPage:20){media(type:MANGA,genres_in:$genres,startDate_greater:$startDate_greater,endDate_lesser:$endDate_lesser){id title{romaji} coverImage{large} chapters startDate{year}}}}`;
render('manga-list',await fetchMedia(v,q),append,'MANGA');
mangaPage++;
}

async function loadMovies(append=false){
let v={page:moviesPage,genres:selectedGenres};
dateVars(v);
const q=`query($page:Int,$genres:[String],$startDate_greater:Int,$endDate_lesser:Int){
Page(page:$page,perPage:20){media(type:ANIME,format:MOVIE,genres_in:$genres,startDate_greater:$startDate_greater,endDate_lesser:$endDate_lesser){id title{romaji} coverImage{large} startDate{year}}}}`;
render('movies-list-main',await fetchMedia(v,q),append,'MOVIE');
moviesPage++;
}

/* ---------------- RENDER ---------------- */
function render(id,items,append,type){
const c=document.getElementById(id);
if(!append)c.innerHTML='';
items.forEach(i=>{
c.innerHTML+=`
<div class="media-item bg-black/40 p-4 rounded mb-3">
<img src="${i.coverImage.large}" class="w-16 h-24 float-left mr-3 rounded">
<b>${i.title.romaji}</b>
<p class="text-sm text-gray-400">${i.startDate?.year||'?'}</p>
<button class="bookmark-btn" data-id="${i.id}" data-title="${i.title.romaji}" data-type="${type}" onclick="bookmark(event,this)">☆</button>
<div style="clear:both"></div>
</div>`;
});
updateBookmarks();
}

function bookmark(e,b){
e.stopPropagation();
let list=getBookmarks();
const id=Number(b.dataset.id);
if(list.some(x=>x.id===id))list=list.filter(x=>x.id!==id);
else list.push({id,title:b.dataset.title,type:b.dataset.type});
setBookmarks(list);
updateBookmarks();
}

function updateBookmarks(){
document.querySelectorAll('.bookmark-btn').forEach(b=>{
b.textContent=getBookmarks().some(x=>x.id==b.dataset.id)?'★':'☆';
});
}

/* ---------------- SEARCH ---------------- */
search-input.oninput=async e=>{
if(e.target.value.length<2){applyFilters();return;}
const type=currentView==='manga'?'MANGA':'ANIME';
const q=`query($s:String,$t:MediaType){Page(page:1,perPage:20){media(search:$s,type:$t){id title{romaji} coverImage{large}}}}`;
const r=await fetch('https://graphql.anilist.co',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:q,variables:{s:e.target.value,t:type}})});
const d=(await r.json()).data.Page.media;
render(currentView+'-list',d,false,type);
};

/* ---------------- INIT ---------------- */
loadGenres();
loadAnime();
</script>

</body>
</html>
